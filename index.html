<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fosol Setu | Every Harvest Deserves Its Full Value</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; background: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        #root:empty::before {
            content: "INITIALIZING FOSOL SETU...";
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #10b981;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 0.75rem;
            background: #ffffff;
        }

        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; background: #e2e8f0; border-radius: 10px; }
        input[type=range]::-webkit-slider-thumb { height: 26px; width: 26px; border-radius: 50%; background: #f59e0b; cursor: pointer; -webkit-appearance: none; margin-top: -9px; border: 4px solid white; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.37.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "recharts": "https://esm.sh/recharts@^3.6.0"
  }
}
</script>
</head>
<body class="text-slate-900 overflow-x-hidden">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // Constants & Translations
        const cropRates = [
            { id: 'aman', name_en: 'Aman Rice', name_bn: 'আমন ধান', rate: 5.556, duration: 150 },
            { id: 'jute', name_en: 'Jute', name_bn: 'পাট', rate: 4.80, duration: 120 },
            { id: 'potato', name_en: 'Potato', name_bn: 'আলু', rate: 7.50, duration: 90 },
            { id: 'wheat', name_en: 'Wheat', name_bn: 'গম', rate: 5.20, duration: 110 },
        ];

        const t = {
            en: {
                home: "Home", market: "Market", finance: "Funds", ai: "Agri-AI", harvest: "Cycle",
                farmer: "Farmer Portal", buyer: "Buyer Portal", today: "Today",
                humidity: "Humidity", wind: "Wind", rain: "Rain", activeCrops: "My Harvests",
                preHarvest: "Pre-Harvest Cash", calcTitle: "Loan Eligibility Calculator",
                landSize: "Land Size (Sq Ft)", result: "Eligible Amount", apply: "Apply Now",
                selectCrop: "Select Crop", askAI: "Ask about crops...", location: "Chittagong",
                calcDesc: "Determine funding based on crop & area"
            },
            bn: {
                home: "হোম", market: "বাজার", finance: "তহবিল", ai: "কৃষি-এআই", harvest: "ফসল চক্র",
                farmer: "কৃষক পোর্টাল", buyer: "ক্রেতা পোর্টাল", today: "আজ",
                humidity: "আর্দ্রতা", wind: "বাতাস", rain: "বৃষ্টি", activeCrops: "আমার ফসল",
                preHarvest: "প্রাক-ফসল নগদ টাকা", calcTitle: "ঋণ যোগ্যতা ক্যালকুলেটর",
                landSize: "জমির পরিমাণ (বর্গফুট)", result: "সম্ভাব্য ঋণের পরিমাণ", apply: "আবেদন করুন",
                selectCrop: "ফসল নির্বাচন", askAI: "ফসল সম্পর্কে জিজ্ঞাসা করুন...", location: "চট্টগ্রাম",
                calcDesc: "জমির পরিমাণ অনুযায়ী ঋণের সীমা দেখুন"
            }
        };

        // UI Components
        const NavBtn = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex flex-col items-center gap-1 transition-all flex-1 ${active ? 'text-green-600 scale-110' : 'text-slate-400'}`}>
                <div dangerouslySetInnerHTML={{ __html: icon }} className="w-6 h-6" />
                <span className="text-[9px] font-black uppercase tracking-widest">{label}</span>
            </button>
        );

        const Financing = ({ lang }) => {
            const [landSize, setLandSize] = useState(900);
            const [crop, setCrop] = useState(cropRates[0]);
            const [loading, setLoading] = useState(false);
            const text = t[lang];

            const amount = useMemo(() => Math.floor(landSize * crop.rate), [landSize, crop]);

            return (
                <div className="space-y-6 pb-20 animate-in fade-in duration-500">
                    <div className="bg-slate-900 p-8 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                        <div className="absolute top-[-20%] left-[-20%] w-48 h-48 bg-green-600/20 rounded-full blur-3xl"></div>
                        <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-2">{lang === 'bn' ? 'বর্তমান ঋণের সীমা' : 'Active Credit Limit'}</p>
                        <h3 className="text-4xl font-black mb-6 text-green-400">৳2,50,000</h3>
                        <div className="grid grid-cols-2 gap-3">
                            <div className="bg-white/5 p-4 rounded-2xl border border-white/10">
                                <p className="text-[9px] uppercase font-bold text-slate-500 mb-1">Interest</p>
                                <p className="text-lg font-black">6.5%</p>
                            </div>
                            <div className="bg-white/5 p-4 rounded-2xl border border-white/10">
                                <p className="text-[9px] uppercase font-bold text-slate-500 mb-1">Term</p>
                                <p className="text-lg font-black">{lang === 'bn' ? '৬ মাস' : '6 Mo'}</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-[2.5rem] border border-slate-200 shadow-xl space-y-6">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                            </div>
                            <div>
                                <h4 className="text-lg font-black">{text.calcTitle}</h4>
                                <p className="text-[9px] font-bold text-slate-400 uppercase">{text.calcDesc}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-2">
                            {cropRates.map(c => (
                                <button key={c.id} onClick={() => setCrop(c)} className={`px-3 py-3 rounded-2xl text-[10px] font-black border-2 transition-all ${crop.id === c.id ? 'bg-amber-500 text-white border-amber-500 shadow-lg' : 'bg-white text-slate-500 border-slate-100'}`}>
                                    {lang === 'bn' ? c.name_bn : c.name_en}
                                </button>
                            ))}
                        </div>

                        <div className="bg-slate-50 p-6 rounded-3xl space-y-4">
                            <div className="flex justify-between items-center text-[10px] font-black uppercase text-slate-400">
                                <span>{text.landSize}</span>
                                <span className="text-amber-600 bg-amber-100 px-3 py-1 rounded-xl text-xs">{landSize} sq ft</span>
                            </div>
                            <input type="range" min="100" max="5000" step="100" value={landSize} onChange={(e) => setLandSize(parseInt(e.target.value))} />
                        </div>

                        <div className="bg-green-600 p-7 rounded-[2.5rem] text-white text-center shadow-2xl">
                            <p className="text-[10px] font-black uppercase opacity-70 mb-1">{text.result}</p>
                            <p className="text-5xl font-black mb-6 tracking-tighter">৳{amount.toLocaleString()}</p>
                            <button onClick={() => { setLoading(true); setTimeout(() => setLoading(false), 2000); }} className="w-full bg-white text-green-700 py-5 rounded-2xl text-xs font-black uppercase shadow-lg active:scale-95 transition-all">
                                {loading ? '...' : text.apply}
                            </button>
                        </div>
                        <p className="text-[9px] text-center text-slate-400 font-bold">* 900 sq ft Aman = ৳5,000 baseline value</p>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ lang, setView, role }) => {
            const text = t[lang];
            return (
                <div className="space-y-6 animate-in fade-in duration-500">
                    <div className="bg-gradient-to-br from-blue-600 to-blue-800 p-6 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                        <div className="flex justify-between items-start mb-6">
                            <div>
                                <p className="text-[10px] font-black uppercase opacity-80">{text.today} • {text.location}</p>
                                <h3 className="text-4xl font-black mt-1">29°C</h3>
                                <p className="text-sm">{lang === 'bn' ? 'আংশিক মেঘলা' : 'Partly Cloudy'}</p>
                            </div>
                            <svg className="w-12 h-12 opacity-30" fill="currentColor" viewBox="0 0 24 24"><path d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>
                        </div>
                        <div className="grid grid-cols-3 gap-2 border-t border-white/10 pt-5 text-center">
                            <div><p className="text-[10px] opacity-60 font-black uppercase">{text.humidity}</p><p className="text-sm font-black">65%</p></div>
                            <div><p className="text-[10px] opacity-60 font-black uppercase">{text.wind}</p><p className="text-sm font-black">12 km/h</p></div>
                            <div><p className="text-[10px] opacity-60 font-black uppercase">{text.rain}</p><p className="text-sm font-black">10%</p></div>
                        </div>
                    </div>

                    {role === 'farmer' && (
                        <button onClick={() => setView('finance')} className="w-full bg-amber-500 p-5 rounded-3xl flex items-center justify-between shadow-xl text-white group">
                            <div className="flex items-center gap-4">
                                <div className="bg-white/20 p-3 rounded-2xl"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                                <div className="text-left"><p className="text-sm font-black">{text.preHarvest}</p><p className="text-[10px] opacity-80 uppercase tracking-widest">{lang === 'bn' ? 'তহবিলের আবেদন করুন' : 'Apply for Funding'}</p></div>
                            </div>
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M9 5l7 7-7 7" /></svg>
                        </button>
                    )}

                    <section className="space-y-4">
                        <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest px-2">{text.activeCrops}</h3>
                        <div className="bg-white p-5 rounded-3xl border border-slate-100 flex items-center justify-between shadow-sm">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center"><svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg></div>
                                <div><p className="text-base font-black">{lang === 'bn' ? 'আমন ধান' : 'Aman Rice'}</p><p className="text-[10px] text-slate-400 font-black uppercase">Flowering</p></div>
                            </div>
                            <span className="text-[9px] font-black text-green-600 uppercase">Excellent</span>
                        </div>
                    </section>
                </div>
            );
        };

        const AgriAI = ({ lang }) => {
            const [msg, setMsg] = useState([]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef();

            useEffect(() => { scrollRef.current?.scrollTo(0, scrollRef.current.scrollHeight); }, [msg]);

            const send = async () => {
                if (!input.trim() || loading) return;
                const cur = input; setInput(''); setMsg(p => [...p, { role: 'user', text: cur }]); setLoading(true);
                try {
                    const ai = new GoogleGenAI({ apiKey: window.process?.env?.API_KEY || '' });
                    const res = await ai.models.generateContent({ 
                        model: 'gemini-3-flash-preview', 
                        contents: cur,
                        config: { systemInstruction: "Agricultural consultant for Chittagong Division, Bangladesh. Concise, helpful advice." }
                    });
                    setMsg(p => [...p, { role: 'ai', text: res.text || "..." }]);
                } catch { setMsg(p => [...p, { role: 'ai', text: "Service temporarily unavailable." }]); }
                finally { setLoading(false); }
            };

            return (
                <div className="flex flex-col h-[70vh] space-y-4">
                    <div ref={scrollRef} className="flex-1 overflow-y-auto space-y-4 p-2 no-scrollbar">
                        {msg.length === 0 && <div className="text-center py-20 opacity-30 text-xs font-bold uppercase tracking-widest">Ask anything about your crops</div>}
                        {msg.map((m, i) => (
                            <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] p-4 rounded-2xl text-sm ${m.role === 'user' ? 'bg-green-600 text-white shadow-lg' : 'bg-white border text-slate-700 shadow-sm'}`}>{m.text}</div>
                            </div>
                        ))}
                    </div>
                    <div className="flex gap-2">
                        <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && send()} placeholder={t[lang].askAI} className="flex-1 bg-white border border-slate-200 px-5 py-4 rounded-3xl text-sm outline-none" />
                        <button onClick={send} className="bg-green-600 text-white p-4 rounded-3xl shadow-lg"><svg className="w-6 h-6 rotate-90" fill="currentColor" viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('dashboard');
            const [lang, setLang] = useState('en');
            const [role, setRole] = useState('farmer');
            const [showMenu, setShowMenu] = useState(false);
            const text = t[lang];

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col shadow-2xl overflow-hidden">
                    <header className="bg-white/90 backdrop-blur-md border-b sticky top-0 z-40 px-5 py-4 flex justify-between items-center">
                        <div className="flex items-center gap-3 relative">
                            <button onClick={() => setShowMenu(!showMenu)} className="w-10 h-10 bg-green-600 rounded-2xl flex items-center justify-center text-white font-black shadow-lg">FS</button>
                            {showMenu && (
                                <div className="absolute top-14 left-0 w-52 bg-white border border-slate-100 rounded-3xl shadow-2xl z-50 overflow-hidden">
                                    {['farmer', 'buyer'].map(r => (
                                        <button key={r} onClick={() => { setRole(r); setShowMenu(false); }} className={`w-full text-left px-5 py-4 text-[10px] font-black uppercase tracking-widest border-b last:border-none ${role === r ? 'text-green-600 bg-green-50' : 'text-slate-500'}`}>{text[r]}</button>
                                    ))}
                                </div>
                            )}
                            <div><h1 className="text-sm font-black text-slate-900 leading-none mb-1 tracking-tight">Fosol Setu</h1><p className="text-[9px] text-green-600 font-black uppercase tracking-widest">{text[role]}</p></div>
                        </div>
                        <button onClick={() => setLang(lang === 'en' ? 'bn' : 'en')} className="bg-slate-100 border px-4 py-2 rounded-2xl text-[10px] font-black uppercase"> {lang === 'en' ? 'BN' : 'EN'} </button>
                    </header>

                    <main className="flex-1 p-5 overflow-y-auto">
                        {view === 'dashboard' && <Dashboard lang={lang} role={role} setView={setView} />}
                        {view === 'finance' && <Financing lang={lang} />}
                        {view === 'ai' && <AgriAI lang={lang} />}
                        {view === 'market' && <div className="py-20 text-center text-slate-300 text-xs font-bold uppercase tracking-widest">Marketplace coming soon</div>}
                    </main>

                    <nav className="sticky bottom-0 bg-white border-t px-6 py-4 flex justify-around items-center z-50 shadow-2xl">
                        <NavBtn active={view === 'dashboard'} onClick={() => setView('dashboard')} label={text.home} icon='<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>' />
                        <NavBtn active={view === 'market'} onClick={() => setView('market')} label={text.market} icon='<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>' />
                        <NavBtn active={view === 'finance'} onClick={() => setView('finance')} label={text.finance} icon='<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' />
                        <NavBtn active={view === 'ai'} onClick={() => setView('ai')} label={text.ai} icon='<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>' />
                    </nav>
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>